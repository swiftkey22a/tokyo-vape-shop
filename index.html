<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOKYO VAPE ¬∑ Êù±‰∫¨</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* ===== –ú–ê–¢–û–í–´–ô –ß–Å–†–ù–´–ô ¬∑ –ß–ò–¢–ê–ï–ú–´–ô –¢–ï–ö–°–¢ ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, 'Helvetica Neue', 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0c;
            color: rgba(255, 255, 255, 0.95);
            min-height: 100vh;
            padding: 20px;
            font-weight: 400;
            letter-spacing: 0.2px;
            line-height: 1.5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* ===== –®–ê–ü–ö–ê ===== */
        .header {
            text-align: center;
            padding: 32px 20px;
            margin-bottom: 28px;
            background: rgba(12, 12, 14, 0.95);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.8);
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 15%;
            right: 15%;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%,
                rgba(255, 100, 120, 0.3) 20%,
                rgba(80, 220, 220, 0.3) 50%,
                rgba(255, 100, 120, 0.3) 80%,
                transparent 100%
            );
        }

        .logo {
            font-size: 2.2rem;
            font-weight: 500;
            letter-spacing: 4px;
            margin-bottom: 12px;
            color: white;
            text-transform: uppercase;
        }

        .logo span {
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.8rem;
            margin-left: 4px;
        }

        .subheader {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85rem;
            letter-spacing: 4px;
            text-transform: uppercase;
            margin-bottom: 8px;
            font-weight: 400;
        }

        .japanese {
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.8rem;
            letter-spacing: 3px;
            font-family: 'Hiragino Sans', 'MS Gothic', monospace;
            margin-top: 12px;
        }

        /* ===== –ü–û–ò–°–ö ===== */
        .search-box {
            margin: 24px 0;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 16px 24px 16px 52px;
            background: rgba(15, 15, 18, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            color: white;
            font-size: 1rem;
            transition: all 0.2s ease;
            backdrop-filter: blur(4px);
            font-weight: 400;
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.35);
            font-weight: 400;
            letter-spacing: 1px;
            font-size: 0.95rem;
        }

        .search-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.2);
            background: rgba(18, 18, 22, 0.95);
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.4);
            font-size: 1.1rem;
        }

        /* ===== –ö–ê–¢–ï–ì–û–†–ò–ò ===== */
        .categories {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            margin: 24px 0;
            padding-bottom: 8px;
            scrollbar-width: none;
        }

        .categories::-webkit-scrollbar {
            display: none;
        }

        .category-btn {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
            letter-spacing: 1.5px;
            font-weight: 400;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .category-btn:hover {
            border-color: rgba(255, 255, 255, 0.25);
            color: rgba(255, 255, 255, 0.9);
        }

        .category-btn.active {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.3);
            color: white;
        }

        /* ===== –°–ï–¢–ö–ê –¢–û–í–ê–†–û–í ===== */
        .products-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            margin: 20px 0 100px;
        }

        @media (min-width: 640px) {
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* ===== –ö–ê–†–¢–û–ß–ö–ê ===== */
        .product-card {
            background: rgba(12, 12, 15, 0.85);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.25s;
            position: relative;
        }

        .product-card:hover {
            background: rgba(15, 15, 18, 0.9);
            border-color: rgba(255, 255, 255, 0.12);
        }

        .product-card::after {
            content: 'Êù±‰∫¨';
            position: absolute;
            bottom: 12px;
            right: 16px;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.15);
            font-family: 'MS Gothic', monospace;
            letter-spacing: 1px;
        }

        .product-brand {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.75rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .product-taste {
            color: white;
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 16px;
            line-height: 1.45;
            letter-spacing: 0.3px;
        }

        .product-details {
            display: flex;
            justify-content: space-between;
            color: rgba(255, 255, 255, 0.55);
            font-size: 0.8rem;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .product-price {
            color: white;
            font-size: 1.5rem;
            font-weight: 500;
            text-align: right;
            margin-bottom: 16px;
            letter-spacing: 1px;
        }

        .product-price::after {
            content: ' ‚ÇΩ';
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.45);
            margin-left: 2px;
        }

        /* ===== –ö–ù–û–ü–ö–ê ===== */
        .add-btn {
            width: 100%;
            padding: 14px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: rgba(255, 255, 255, 0.85);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .add-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.3);
            color: white;
        }

        .add-btn:disabled {
            opacity: 0.35;
            cursor: not-allowed;
            border-color: rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.4);
        }

        /* ===== –ö–û–†–ó–ò–ù–ê ===== */
        .cart {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(18, 18, 22, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            width: 64px;
            height: 64px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.7rem;
            cursor: pointer;
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.8);
            z-index: 1000;
            transition: all 0.25s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .cart:hover {
            background: rgba(22, 22, 28, 0.95);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .cart-count {
            position: absolute;
            top: -4px;
            right: -4px;
            background: rgba(255, 120, 140, 0.9);
            backdrop-filter: blur(4px);
            color: white;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.15);
            font-weight: 500;
        }

        /* ===== –°–¢–ê–¢–£–°–´ ===== */
        .in-stock { 
            color: #a0e0a0; 
            font-weight: 500;
        }
        .low-stock { 
            color: #ffd280; 
            font-weight: 500;
        }
        .out-stock { 
            color: #ffa0a0; 
            font-weight: 500;
        }

        /* ===== –§–£–¢–ï–† ===== */
        .footer {
            text-align: center;
            margin-top: 60px;
            padding-top: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.8rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            font-weight: 400;
        }

        .seller {
            color: rgba(255, 255, 255, 0.65);
            text-decoration: none;
            transition: color 0.2s;
            font-weight: 500;
        }

        .seller:hover {
            color: white;
        }

        /* ===== –ó–ê–ì–†–£–ó–ö–ê ===== */
        .loading {
            text-align: center;
            padding: 50px;
            color: rgba(255, 255, 255, 0.5);
            font-weight: 400;
            letter-spacing: 2px;
        }

        .spinner {
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.4s ease; }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–ê–ü–ö–ê -->
        <div class="header fade-in">
            <div class="logo">TOKYO VAPE<span>üóæ</span></div>
            <div class="subheader">–ñ–ò–î–ö–û–°–¢–ò ¬∑ –ü–û–î–´ ¬∑ –ê–ö–°–ï–°–°–£–ê–†–´</div>
            <div class="japanese">Êù±‰∫¨„Éô„Ç§„Éó</div>
        </div>
        
        <!-- –ü–û–ò–°–ö -->
        <div class="search-box">
            <span class="search-icon">‚ö≤</span>
            <input type="text" id="searchInput" class="search-input" 
                   placeholder="–ü–û–ò–°–ö –ü–û –í–ö–£–°–ê–ú">
        </div>
        
        <!-- –ö–ê–¢–ï–ì–û–†–ò–ò -->
        <div class="categories" id="categories"></div>
        
        <!-- –¢–û–í–ê–†–´ -->
        <div id="productsContainer">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>–ó–ê–ì–†–£–ó–ö–ê –ö–ê–¢–ê–õ–û–ì–ê</p>
            </div>
            <div class="products-grid" id="productsGrid"></div>
        </div>
        
        <!-- –ö–û–†–ó–ò–ù–ê -->
        <div class="cart" onclick="showCart()">
            üõí
            <span class="cart-count" id="cartCount">0</span>
        </div>
        
        <!-- –§–£–¢–ï–† -->
        <div class="footer">
            <a href="https://t.me/drugsoutlety" class="seller">@drugsoutlety</a>
            <p style="margin-top: 12px;">TOKYO VAPE ¬∑ 2026</p>
        </div>
    </div>

    <script>
        const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbzYFbWlnLlcti3b52H7TdJ4gu760oqeYgdk09OtGrEKfBWtCJtYqjU1fUWDoCu800nOlQ/exec';
        
        let allProducts = [];
        let cart = JSON.parse(localStorage.getItem('tokyoCart')) || {};
        
        async function loadProducts() {
            try {
                const response = await fetch(GOOGLE_SHEETS_URL + '?t=' + Date.now());
                const data = await response.json();
                if (data.success) {
                    allProducts = data.products || [];
                    renderCategories(data.categories || []);
                    renderProducts(allProducts);
                    updateCartCount();
                }
            } catch (error) {
                console.log('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ');
                loadTestData();
            }
            document.getElementById('loading').classList.add('hidden');
        }
        
        function loadTestData() {
            allProducts = [
                { id: '1', brand: 'ANIMMA', taste: 'ITACHI –í–ò–®–ù–Ø –ê–ô–°', price: 500, strength: '70MG', stock: 3, category: 'ICED', emoji: '‚óà' },
                { id: '2', brand: 'ANIMMA', taste: 'JUGO –ê–†–ë–£–ó –ê–ô–°', price: 500, strength: '70MG', stock: 3, category: 'ICED', emoji: '‚óà' },
                { id: '3', brand: 'ANIMMA', taste: 'SASUKE –ú–ê–õ–ò–ù–ê –ê–ô–°', price: 500, strength: '70MG', stock: 3, category: 'ICED', emoji: '‚óà' },
                { id: '4', brand: '–ó–õ–ê–Ø –ú–û–ù–ê–®–ö–ê ICE', taste: 'MANGO MIX', price: 550, strength: '50MG', stock: 5, category: 'ICED', emoji: '‚óà' },
                { id: '5', brand: '–ó–õ–ê–Ø –ú–û–ù–ê–®–ö–ê SOUR', taste: '–ö–ò–°–õ–´–ô –ê–ü–ï–õ–¨–°–ò–ù', price: 550, strength: '70MG', stock: 2, category: 'SOUR', emoji: '‚óà' },
                { id: '6', brand: 'VAPORESSO XROS 5', taste: 'RED LEATHER', price: 2400, strength: 'POD', stock: 1, category: 'PODS', emoji: '‚óà' }
            ];
            renderCategories(['ICED', 'SOUR', 'PODS']);
            renderProducts(allProducts);
        }
        
        function renderCategories(cats) {
            const container = document.getElementById('categories');
            container.innerHTML = '<button class="category-btn active" onclick="showAll(event)">‚óà –í–°–ï</button>';
            cats.sort().forEach(cat => {
                container.innerHTML += `<button class="category-btn" onclick="filterCategory(event, '${cat}')">‚óà ${cat}</button>`;
            });
        }
        
        function renderProducts(products) {
            if (!products || products.length === 0) {
                document.getElementById('productsGrid').innerHTML = '<div style="text-align:center;padding:40px;color:rgba(255,255,255,0.3);">‚Äî –¢–û–í–ê–†–´ –ù–ï –ù–ê–ô–î–ï–ù–´ ‚Äî</div>';
                return;
            }
            
            let html = '';
            products.forEach(p => {
                let stockClass = p.stock > 2 ? 'in-stock' : p.stock > 0 ? 'low-stock' : 'out-stock';
                let stockText = p.stock > 0 ? `${p.stock} —à—Ç` : '–ù–ï–¢';
                
                html += `
                    <div class="product-card fade-in">
                        <div class="product-brand">${p.emoji || '‚óà'} ${p.brand}</div>
                        <div class="product-taste">${p.taste}</div>
                        <div class="product-details">
                            <span>${p.strength || ''}</span>
                            <span class="${stockClass}">${stockText}</span>
                        </div>
                        <div class="product-price">${p.price}</div>
                        <button class="add-btn" onclick="addToCart('${p.id}')" ${p.stock <= 0 ? 'disabled' : ''}>
                            + ${p.stock <= 0 ? '–ù–ï–¢' : '–í –ö–û–†–ó–ò–ù–£'}
                        </button>
                    </div>
                `;
            });
            document.getElementById('productsGrid').innerHTML = html;
        }
        
        function showAll(event) {
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            filterProducts();
        }
        
        function filterCategory(event, category) {
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            renderProducts(allProducts.filter(p => p.category === category));
        }
        
        function filterProducts() {
            let query = document.getElementById('searchInput').value.toLowerCase();
            renderProducts(query ? allProducts.filter(p => 
                p.taste.toLowerCase().includes(query) || 
                p.brand.toLowerCase().includes(query)
            ) : allProducts);
        }
        
        function addToCart(id) {
            let product = allProducts.find(p => p.id === id);
            if (!product || product.stock <= 0) return;
            
            if (!cart[id]) {
                cart[id] = { ...product, quantity: 1 };
            } else {
                if (cart[id].quantity < product.stock) {
                    cart[id].quantity++;
                } else {
                    alert(`‚ö†Ô∏è –ú–∞–∫—Å–∏–º—É–º ${product.stock} —à—Ç`);
                    return;
                }
            }
            
            localStorage.setItem('tokyoCart', JSON.stringify(cart));
            updateCartCount();
            
            let badge = document.getElementById('cartCount');
            badge.style.transform = 'scale(1.1)';
            setTimeout(() => badge.style.transform = 'scale(1)', 200);
        }
        
        function updateCartCount() {
            let total = Object.values(cart).reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = total;
        }
        
        function showCart() {
            let items = Object.values(cart);
            if (items.length === 0) {
                alert('üõí –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
                return;
            }
            
            let message = 'TOKYO VAPE ¬∑ –ñ–ò–î–ö–û–°–¢–ò ¬∑ –ü–û–î–´\n\n';
            let total = 0;
            
            items.forEach(item => {
                let sum = item.price * item.quantity;
                total += sum;
                message += `${item.taste}\n`;
                message += `${item.quantity} √ó ${item.price}‚ÇΩ = ${sum}‚ÇΩ\n\n`;
            });
            
            message += `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n`;
            message += `–ò–¢–û–ì–û: ${total} ‚ÇΩ`;
            
            window.open(`https://t.me/drugsoutlety?text=${encodeURIComponent(message)}`, '_blank');
            
            cart = {};
            localStorage.removeItem('tokyoCart');
            updateCartCount();
        }
        
        document.getElementById('searchInput').addEventListener('input', filterProducts);
        
        document.addEventListener('DOMContentLoaded', () => {
            if (window.Telegram?.WebApp) {
                Telegram.WebApp.expand();
                Telegram.WebApp.setHeaderColor('#0a0a0c');
            }
            loadProducts();
            updateCartCount();
        });
    </script>
</body>
</html>